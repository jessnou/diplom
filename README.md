# Lane Departure Warning (LDW) для автобусов

## 1. Постановка задачи

### Бизнес-задача
Автобусные компании хотят снизить риск аварий, связанных с выездом за пределы полосы движения, повысить безопасность пассажиров и сократить количество штрафов за нарушение ПДД.

### ML/CV формулировка
Разработать систему компьютерного зрения для **детекции дорожной разметки и удержания полосы движения** на видео с камер, установленных в автобусе.  
**Тип задачи:** семантическая сегментация и детекция дорожной разметки в реальном времени.

Пример формулировки:
> «Задача семантической сегментации дорожной разметки на видеопотоке с камер автобуса с целью своевременного оповещения водителя о выходе за пределы полосы движения (LDW).»

---

## 2. Анализ предметной области

### Контекст
- **Отрасль:** пассажирские перевозки (городской и междугородний транспорт)  
- **Тип оборудования:** автобусы с фронтальными/панорамными камерами, возможные дополнительные датчики (GPS, IMU)  
- **Типичные сценарии:**  
  - Движение по городской улице с полосами различной ширины  
  - Движение по скоростной трассе  
  - Ночные условия, дождь, снег, частичная разметка  
- **Участники процесса:**  
  - Водитель (получает предупреждения)  
  - Оператор автопарка (мониторинг)  
  - Заказчик/бизнес (снижение аварийности)  
  - Регуляторы (допустимые стандарты безопасности)

### Ключевые метрики эффективности
- Точность детекции разметки: Precision, Recall ≥ 0.95  
- Время реакции системы: Latency ≤ 200 мс на кадр  
- Надёжность при плохих погодных/освещённых условиях  
- Снижение количества нарушений полосы (KPI бизнеса)

---

## 3. Обзор известных решений

| Название решения / подхода | Тип задачи | Методы и инструменты | Преимущества | Недостатки | Лицензия | Поддержка edge/cloud, требования к HW |
|----------------------------|------------|--------------------|-------------|------------|----------|--------------------------------------|
| SCNN: Spatial CNN for Lane Detection | Семантическая сегментация | CNN, Spatial CNN, PyTorch | Высокая точность на сложных дорогах | Требует GPU для инференса | MIT | GPU/Edge поддержка ограничена |
| LaneNet | Сегментация + кластеризация | CNN, TensorFlow, Instance Segmentation | Может работать в реальном времени | Чувствителен к плохой разметке | MIT | Поддержка edge, можно оптимизировать для Jetson |
| OpenPilot / Comma.ai | LDW и ADAS | CNN, OpenCV, PyTorch, датчики IMU | Рабочая система для автомобилей | Не специализировано для автобусов | Apache 2.0 | Edge-ориентированная система |

---

## 4. Стейкхолдеры
- **Заказчик:** автобусные компании, муниципальный транспорт  
- **Пользователи:** водители, диспетчеры  
- **Регуляторы:** органы транспортного надзора  
- **Операторы:** разработчики и техподдержка системы  

---

## 5. Ограничения

**Аппаратные:**  
- Инференс на Jetson Nano / аналогичных edge-устройствах  
- Камеры с разрешением 720p–1080p  

**Временные:**  
- Разработка прототипа за 8–12 недель  

**Юридические:**  
- GDPR: видео с лицами и номерами не сохраняются  
- Нет распознавания лиц  

**Бюджетные:**  
- Минимизация расходов на облачные решения  

---

## 6. Критерии успеха

**Количественные:**  
- Recall ≥ 0.95 для дорожной разметки  
- Latency ≤ 200 мс на кадр  
- Точность предупреждений ≥ 90%  

**Качественные:**  
- Система не требует ручной калибровки перед каждой поездкой  
- Автоматическая работа в любых условиях освещения  

---

## 7. Границы системы

**Что входит:**  
- Детекция полос движения  
- LDW-оповещение водителя  
- Обработка видеопотока в реальном времени  

**Что не входит:**  
- Распознавание лиц или номеров  
- Запись видео на сервер  
- Детекция других объектов (пешеходы, автомобили)  


# Задание 4 – Архитектура и выбор инструментов

## Цель
Обосновать выбор архитектуры системы LDW для автобусов с использованием стандартов проектирования и показать, как компоненты взаимодействуют между собой.

---

## 1. UML-диаграммы (текстовое описание)

### Use Case Diagram
**Акторы:**
- Водитель автобуса — получает предупреждения о выходе за пределы полосы.  
- Диспетчер — мониторинг статистики выездов.  
- Система LDW — выполняет детекцию разметки и генерацию алертов.  

**Сценарии:**
- Детекция полосы движения и предупреждение водителя.  
- Агрегация статистики выездов для диспетчера.  
- Логирование событий и анонимизация данных.  

### Component Diagram
**Компоненты системы:**
- **Камера** — фронтальная или панорамная, захват видеопотока.  
- **Edge устройство (Jetson Orin NX)** — выполняет инференс модели и обработку видео.  
- **Модель Deep Learning (YOLOv8n)** — детекция полосы, распознавание паттернов.  
- **OpenCV** — трекинг объектов, фильтрация шумов.  
- **API (FastAPI)** — REST интерфейс для передачи статистики и алертов.  
- **Диспетчерская панель** — отображение агрегированной информации о выездах.  

---

## 2. Выбор подхода

**Критерии выбора:**
- **Сложность задачи:** распознавание паттернов дорожной разметки, возможно агрессивное поведение водителя, нестабильное освещение → Deep Learning.  
- **Реальные условия:** ограниченный объем размеченных данных для агрессии → используем синтетические данные и дообучаем на реальных примерах.  
- **Ограничения edge-устройства:** Jetson Orin NX → выбираем YOLOv8n + TensorRT для ускоренного инференса.  

**Гибридный подход:**
- **YOLO** — детекция полос и объектов.  
- **OpenCV** — трекинг и фильтрация шумов, подсчёт выездов, улучшение стабильности.  

---

## 3. Инструменты

- **Язык:** Python  
- **Библиотеки:**  
  - OpenCV — обработка видео и трекинг  
  - PyTorch — обучение и инференс модели YOLO  
  - Albumentations — аугментация данных  
  - ONNX / TensorRT — оптимизация модели для edge  
- **Деплой:** Docker + FastAPI на edge-устройстве  

---

## 4. Обоснование

- Работа на **Jetson Orin NX** требует компактной и быстрой модели → YOLOv8n + TensorRT.  
- Нет больших размеченных данных по агрессивным действиям → используем синтетические сцены + fine-tune на 500 реальных кадрах.  
- Edge-ориентированная архитектура обеспечивает минимальную задержку (latency ≤ 200 мс) и безопасность данных пассажиров. 

