# Lane Departure Warning (LDW) для автобусов

## 1. Постановка задачи

### Бизнес-задача
Автобусные компании хотят снизить риск аварий, связанных с выездом за пределы полосы движения, повысить безопасность пассажиров и сократить количество штрафов за нарушение ПДД.

### ML/CV формулировка
Разработать систему компьютерного зрения для **детекции дорожной разметки и удержания полосы движения** на видео с камер, установленных в автобусе.  
**Тип задачи:** семантическая сегментация и детекция дорожной разметки в реальном времени.

Пример формулировки:
> «Задача семантической сегментации дорожной разметки на видеопотоке с камер автобуса с целью своевременного оповещения водителя о выходе за пределы полосы движения (LDW).»

---

## 2. Анализ предметной области

### Контекст
- **Отрасль:** пассажирские перевозки (городской и междугородний транспорт)  
- **Тип оборудования:** автобусы с фронтальными/панорамными камерами, возможные дополнительные датчики (GPS, IMU)  
- **Типичные сценарии:**  
  - Движение по городской улице с полосами различной ширины  
  - Движение по скоростной трассе  
  - Ночные условия, дождь, снег, частичная разметка  
- **Участники процесса:**  
  - Водитель (получает предупреждения)  
  - Оператор автопарка (мониторинг)  
  - Заказчик/бизнес (снижение аварийности)  
  - Регуляторы (допустимые стандарты безопасности)

### Ключевые метрики эффективности
- Точность детекции разметки: Precision, Recall ≥ 0.95  
- Время реакции системы: Latency ≤ 200 мс на кадр  
- Надёжность при плохих погодных/освещённых условиях  
- Снижение количества нарушений полосы (KPI бизнеса)

---

## 3. Обзор известных решений

| Название решения / подхода | Тип задачи | Методы и инструменты | Преимущества | Недостатки | Лицензия | Поддержка edge/cloud, требования к HW |
|----------------------------|------------|--------------------|-------------|------------|----------|--------------------------------------|
| SCNN: Spatial CNN for Lane Detection | Семантическая сегментация | CNN, Spatial CNN, PyTorch | Высокая точность на сложных дорогах | Требует GPU для инференса | MIT | GPU/Edge поддержка ограничена |
| LaneNet | Сегментация + кластеризация | CNN, TensorFlow, Instance Segmentation | Может работать в реальном времени | Чувствителен к плохой разметке | MIT | Поддержка edge, можно оптимизировать для Jetson |
| OpenPilot / Comma.ai | LDW и ADAS | CNN, OpenCV, PyTorch, датчики IMU | Рабочая система для автомобилей | Не специализировано для автобусов | Apache 2.0 | Edge-ориентированная система |

---

## 4. Стейкхолдеры
- **Заказчик:** автобусные компании, муниципальный транспорт  
- **Пользователи:** водители, диспетчеры  
- **Регуляторы:** органы транспортного надзора  
- **Операторы:** разработчики и техподдержка системы  

---

## 5. Ограничения

**Аппаратные:**  
- Инференс на Jetson Orin NX / аналогичных edge-устройствах  
- Камеры с разрешением 720p–1080p  

**Временные:**  
- Разработка прототипа за 8–12 недель  

**Юридические:**  
- GDPR: видео с лицами и номерами не сохраняются  
- Нет распознавания лиц  

---

## 6. Критерии успеха

**Количественные:**  
- Recall ≥ 0.95 для дорожной разметки  
- Latency ≤ 200 мс на кадр  
- Точность предупреждений ≥ 90%  

**Качественные:**  
- Система не требует ручной калибровки перед каждой поездкой  
- Автоматическая работа в любых условиях освещения  

---

## 7. Границы системы

**Что входит:**  
- Детекция полос движения  
- LDW-оповещение водителя  
- Обработка видеопотока в реальном времени  

**Что не входит:**  
- Распознавание лиц или номеров  
- Запись видео на сервер  
- Детекция других объектов (пешеходы, автомобили)  

## 8. UML-диаграммы (текстовое описание)

### Use Case Diagram

**Акторы:**
- Водитель автобуса — получает предупреждения о выходе за пределы полосы.  
- Диспетчер — мониторинг статистики выездов.  
- Система LDW — выполняет детекцию разметки и генерацию алертов.  

**Основные сценарии:**

**1.Обработка видеопотока**
- Захват видеопотока с камер.
- Детекция дорожной разметки (YOLO / Deep Learning).
- Трекинг объектов и фильтрация шумов (OpenCV).
- Генерация события «выезд за полосу» при нарушении.
  
**2.Предупреждение водителя**
- Получение события «выезд за полосу» от процесса обработки.
- Отображение предупреждения на UI (сигнал, визуальный индикатор).

**3.Агрегация статистики для диспетчера**
- Локальное сохранение события (в агрегированной форме, без лиц).
- Передача статистики на диспетчерскую панель через REST API.
- Просмотр отчетов: количество выездов, частота по маршрутам, время суток.

**4.Этическая обработка данных**
- Размытие лиц пассажиров.
- Агрегация данных без хранения исходного видео.
  
### Component Diagram

**Компоненты системы:**

**Основные компоненты:**

**1. Камеры автобуса** 
- фронтальная или панорамная
- Отправляют видеопоток на Edge

**2. Edge устройство (Jetson Orin NX)** 

**Видео процессинг**
- фильтрация шумов (OpenCV)
- Детекция дорожной разметки
- Размывает лица пассажиров

**Event Generator**
- Формирует события «выезд за полосу»

**UI-сервис для водителя**
- Отправка предупреждений на панель водителя

**3. REST API** 
- отправка агрегированных событий на диспетчерскую панель через 4G

**4. Диспетчерская панель** 
- Получает статистику
- Отображает отчеты по маршрутам и времени суток

![Диаграмма без названия](https://github.com/user-attachments/assets/ddc94527-7de8-4154-bf4b-1b2e84120e70)


**Связи компонентов:**
- Камеры → Edge устройство (stream)
- Edge устройство → UI водителя (локальный вывод)
- Edge устройство → REST API → Диспетчерская панель (агрегированная статистика)
 
## 9. Обоснование

- Работа на **Jetson Orin NX** требует компактной и быстрой модели.  
- Edge-ориентированная архитектура обеспечивает минимальную задержку (latency ≤ 200 мс) и безопасность данных пассажиров. 

